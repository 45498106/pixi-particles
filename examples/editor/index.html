<!DOCTYPE html>
<html class="no-js">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Particle Editor</title>
        <meta name="description" content="">

        <link rel="stylesheet" href="css/normalize.min.css">
        <link rel="stylesheet" href="css/main.css">
		<link href="jquery-ui-smoothness/jquery-ui.min.css" rel="stylesheet">
		<link href="colorpicker/jquery.colorpicker.css" rel="stylesheet">
		
		<script src="jquery-ui-smoothness/external/jquery/jquery.js"></script>
		<script src="jquery-ui-smoothness/jquery-ui.min.js"></script>
		<script src="colorpicker/jquery.colorpicker.js"></script>

		<script src="../libs/preloadjs/lib/preloadjs.min.js"></script>
		<script src="../libs/pixi.js/bin/pixi.dev.js"></script>
		<script src="../libs/cloudkid-namespace/namespace.js"></script>
		<script src="../libs/cloudkid-debug/dist/cloudkid-debug.js"></script>
		<script src="../libs/cloudkid-framework/dist/cloudkid-framework.js"></script>
		<script src="../libs/cloudkid-tasks/dist/cloudkid-tasks.js"></script>
		<script src="../libs/cloudkid-pixi-display/dist/cloudkid-pixi-display.js"></script>
		
		<script src="../../dist/cloudkid-particles.js"></script>

		<script src="Editor.js"></script>
    </head>
    <body>
		<div id="content">
			<div id="framerate" style="z-index:1; position:absolute;"></div>
			<canvas id="stage" style="z-index:0;" width="800" height="500"></canvas>
		</div>
		<div id="editor">
			<div class="option">
				<button id="refresh" title="Reloads the displayed particles from the settings below">Refresh Display</button>
				<button id="loadConfig" title="Load a particle settings file to edit">Load</button>
				<!--<button id="clipboard" title="Copy the particle settings to the clipboard">Copy to Clipboard</button>-->
				<button id="downloadConfig" title="Download a JSON file of the particle settings">Download</button>
			</div>
			<div id="configDialog" title="Upload a particle settings JSON:">
				<select id="defaultConfigSelector">
					<option selected="selected">-Default Emitters-</option>
					<option>trail</option>
					<option>flame</option>
					<option>gas</option>
					<option>explosion</option>
					<option>explosion2</option>
					<option>megamanDeath</option>
					<option>rain</option>
				</select>
				<input id="configUpload" type="file" accept='text/json'></input>
				<textarea id="configPaste" class="ui-autocomplete-input" rows="5"></textarea>
			</div>
			<h3>Particle Properties</h3>
			<div id="alpha" class="option">
				<div class="category" title="Transparency of the particles from 0 (transparent) to 1 (opaque)">Alpha</div>
				<div class="label">Start</div>
				<div id="alphaStart" class="unitSlider slider">
					<input type="text" class="ui-autocomplete-input"></input>
					<label class="sliderStart">0</label>
					<label class="sliderEnd">1</label>
				</div>
				<div class="label">End</div>
				<div id="alphaEnd" class="unitSlider slider">
					<input type="text" class="ui-autocomplete-input"></input>
					<label class="sliderStart">0</label>
					<label class="sliderEnd">1</label>
				</div>
			</div>
			<div id="scale" class="option">
				<div class="category" title="Scale of the particles, with a minimum value of 0">Scale</div>
				<div class="label">Start</div>
				<input id="scaleStart" type="text" class="positiveSpinner spinner"></input>
				<div class="label">End</div>
				<input id="scaleEnd" type="text" class="positiveSpinner spinner"></input>
			</div>
			<div id="color" class="option">
				<div class="category" title="Color of the particles">Color</div>
				<div class="label">Start</div>
				<input id="colorStart" type="text" class="colorPicker"></input>
				<div class="label">End</div>
				<input id="colorEnd" type="text" class="colorPicker"></input>
			</div>
			<div id="speed" class="option">
				<div class="category" title="Speed of the particles">Speed</div>
				<div class="label">Start</div>
				<input id="speedStart" type="text" class="generalSpinner spinner"></input>
				<div class="label">End</div>
				<input id="speedEnd" type="text" class="generalSpinner spinner"></input>
			</div>
			<div id="startRotation" class="option">
				<div class="category" title="Angle at which particles are are pointed when emitted in degrees - 0 is to the right, 90 is down. This is ignored in 'arc' and 'burst' emission types">Start Rotation</div>
				<div class="label">Min</div>
				<input id="startRotationMin" type="text" class="generalSpinner spinner"></input>
				<div class="label">Max</div>
				<input id="startRotationMax" type="text" class="generalSpinner spinner"></input>
			</div>
			<div id="rotationSpeed" class="option">
				<div class="category" title="Speed in degrees per second that particles rotate - Positive numbers are clockwise">Rotation Speed</div>
				<div class="label">Min</div>
				<input id="rotationSpeedMin" type="text" class="generalSpinner spinner"></input>
				<div class="label">Max</div>
				<input id="rotationSpeedMax" type="text" class="generalSpinner spinner"></input>
			</div>
			<div id="particleLife" class="option">
				<div class="category" title="Lifetime of each particle in seconds">Lifetime</div>
				<div class="label">Min</div>
				<input id="lifeMin" type="text" class="positiveSpinner spinner"></input>
				<div class="label">Max</div>
				<input id="lifeMax" type="text" class="positiveSpinner spinner"></input>
			</div>
			<div id="ease" class="option">
				<div class="category" title="Custom ease, as shown by the array output by http://www.greensock.com/customease/">Custom Ease</div>
				<input id="customEase" type="text" class="ui-autocomplete-input"></input>
			</div>
			<div id="images" class="option">
				<div class="category" title="Images that each particle will be given randomly when spawned">Particle Images</div>
				<button id="addImage" class="ui-icon ui-icon-folder-open"></button>
				<div id="imageList">
					<div class="particleImage">
						<img class="actualImage" src="particle.png" />
						<button class="download"></button>
						<button class="remove"></button>
					</div>
				</div>
			</div>
			<div id="imageDialog" title="Choose an image:">
				<select id="defaultImageSelector">
					<option selected="selected">-Default Images-</option>
					<option>particle.png</option>
					<option>smokeparticle.png</option>
					<option>rain.png</option>
				</select>
				<input id="imageUpload" type="file" multiple accept='image/*'></input>
			</div>
			<h3>Emitter Properties</h3>
			<div id="frequency" class="option">
				<div class="category" title="Seconds between each particle being spawned">Spawn Frequency</div>
				<input id="emitFrequency" type="text" class="frequencySpinner spinner"></input>
			</div>
			<div id="emitLife" class="option">
				<div class="category" title="Lifetime of the emitter in seconds before it disables itself">Emitter Lifetime</div>
				<input id="emitLifetime" type="text" class="generalSpinner spinner"></input>
			</div>
			<div id="maxParticles" class="option">
				<div class="category" title="Maximum number of particles that can exist at once">Max Particles</div>
				<input id="emitMaxParticles" type="text" class="posIntSpinner spinner"></input>
			</div>
			<div id="spawnType" class="option">
				<div class="category" title="Settings that control different types of particle spawning">Spawn Type</div>
				<select id="emitSpawnType">
					<option value="point" selected="selected">Point</option>
					<option value="rect">Rectangle</option>
					<option value="circle">Circle</option>
					<option value="burst">Burst</option>
				</select>
			</div>
			<div id="rect" class="option settings-rect">
				<div class="category" title="Rectangle relative to the Spawn Position inside which particles are spawned">Emission Rectangle</div>
				<div class="label">X</div>
				<input id="emitRectX" type="text" class="generalSpinner spinner"></input>
				<div class="label">Y</div>
				<input id="emitRectY" type="text" class="generalSpinner spinner"></input>
				<div class="label">Width</div>
				<input id="emitRectW" type="text" class="generalSpinner spinner"></input>
				<div class="label">Height</div>
				<input id="emitRectH" type="text" class="generalSpinner spinner"></input>
			</div>
			<div id="circle" class="option settings-circle">
				<div class="category" title="Circle relative to the Spawn Position inside which particles are spawned">Emission Circle</div>
				<div class="label">X</div>
				<input id="emitCircleX" type="text" class="generalSpinner spinner"></input>
				<div class="label">Y</div>
				<input id="emitCircleY" type="text" class="generalSpinner spinner"></input>
				<div class="label">Radius</div>
				<input id="emitCircleR" type="text" class="generalSpinner spinner"></input>
			</div>
			<div id="particlesPerWave" class="option settings-burst">
				<div class="category" title="Number of particles to spawn in each burst wave">Particles per Wave</div>
				<input id="emitParticlesPerWave" type="text" class="posIntSpinner spinner"></input>
			</div>
			<div id="particleSpacing" class="option settings-burst">
				<div class="category" title="Spacing in degrees between particles within a wave. 0 gives a random angle for each particle">Particle Spacing</div>
				<input id="emitParticleSpacing" type="text" class="generalSpinner spinner"></input>
			</div>
			<div id="angleStart" class="option settings-burst">
				<div class="category" title="Angle to start spawning particles at in each wave">Start Angle</div>
				<input id="emitAngleStart" type="text" class="generalSpinner spinner"></input>
			</div>
			<div id="spawnPos" class="option">
				<div class="category" title="Position relative to the emitter's owner at which to spawn particles">Spawn Position</div>
				<div class="label">X</div>
				<input id="emitSpawnPosX" type="text" class="generalSpinner spinner"></input>
				<div class="label">Y</div>
				<input id="emitSpawnPosY" type="text" class="generalSpinner spinner"></input>
			</div>
			<div id="addAtBack" class="option">
				<div class="category" title="If particles should be added to the back of the display list instead of the top">Add Particles At Back</div>
				<input id="emitAddAtBack" type="checkbox"></input>
			</div>
		</div>
		<script>
			//initialize jquery UI
			$(document).tooltip();//enable tooltips for any element with a title attribute
			//enable the buttons at the top
			$("#refresh").button({icons:{primary:"ui-icon-arrowrefresh-1-s"}});
			$("#loadConfig").button({icons:{primary:"ui-icon-folder-open"}});
			//$("#clipboard").button({icons:{primary:"ui-icon-copy"}});
			$("#downloadConfig").button({icons:{primary:"ui-icon-arrowthickstop-1-s"}});
			//$("button").button();//enable all button elements
			//enable all unit sliders (0-1)
			$(".unitSlider").slider({
				animate: "fast",
				min: 0,
				max: 1,
				step: 0.01
			});
			//set up all sliders to change their text input when they slide or
			//or are changed externally
			var sliders = $(".slider");
			sliders.on("slide slidechange", function(event, ui) {
				$(this).children("input").val(ui.value);
			});
			//set up all sliders to get changed by their text inputs
			//this also changes the text input, which clamps values in the sliders
			$(".slider input").change(function() {
				$(this).parent().slider("value", $(this).val().replace(/[^0-9.]+/,""));
			});
			//set up all spinners that can't go negative
			$(".positiveSpinner").spinner({
				min: 0,
				numberFormat: "n",
				step: 0.01
			});
			//set up all spinners that can't go negative
			$(".frequencySpinner").spinner({
				min: 0,
				numberFormat: "n",
				step: 0.001
			});
			//set up general spinners
			$(".generalSpinner").spinner({
				numberFormat: "n",
				step: 0.1
			});
			//set up integer spinners
			$(".posIntSpinner").spinner({
				min: 1,
				step: 1
			});
			//enable color pickers
			$(".colorPicker").colorpicker({
				parts: ["header", "map", "bar", "hsv", "rgb", "hex", "preview", "footer"],
				showOn: "both",
				buttonColorize: true,
				revert: true,
				mode: "h",
				buttonImage: "colorpicker/images/ui-colorpicker.png"
			});
			//enable image upload dialog
			$("#addImage").button();
			$("#addImage").click(function(event) {
				$("#defaultImageSelector").find("option:contains('-Default Images-')").prop("selected",true);
				$("#defaultImageSelector").selectmenu("refresh");
				$("#imageUpload").wrap('<form>').parent('form').trigger('reset');
    			$("#imageUpload").unwrap();
				$("#imageDialog").dialog("open");
				event.preventDefault();
			});
			$("#imageDialog").dialog({
				autoOpen: false,
				width: 400,
				buttons: [
					{
						text: "Cancel",
						click: function() {
							$(this).dialog( "close" );
						}
					}
				]
			});
			$("#defaultImageSelector").selectmenu();
			//enable config upload dialog
			$("#loadConfig").click(function(event) {
				$("#defaultConfigSelector").find("option:contains('-Default Emitters-')").prop("selected",true);
				$("#defaultConfigSelector").selectmenu("refresh");
				$("#configUpload").wrap('<form>').parent('form').trigger('reset');
    			$("#configUpload").unwrap();
    			$("#configPaste").val("");
				$("#configDialog").dialog("open");
				event.preventDefault();
			});
			$("#configDialog").dialog({
				autoOpen: false,
				width: 400,
				buttons: [
					{
						text: "Cancel",
						click: function() {
							$(this).dialog( "close" );
						}
					}
				]
			});
			$("#defaultConfigSelector").selectmenu();
			//enable spawn type stuff
			$("#emitSpawnType").selectmenu({
				select: function(event, ui)
				{
					var spawnTypes = cloudkid.Application.instance.spawnTypes;
					var value = $("#emitSpawnType option:selected").val();
					for(var i = 0; i < spawnTypes.length; ++i)
					{
						if(spawnTypes[i] == value)
							$(".settings-" + spawnTypes[i]).show();
						else
							$(".settings-" + spawnTypes[i]).hide();
					}
				}
			});
		</script>
		<script>
			//initialize editor app
			var app = new cloudkid.Editor({
				framerate: "framerate",
				fps: 60,
				raf: true,

				canvasId: "stage",
				display: cloudkid.PixiDisplay,
				displayOptions: {
					clearView: true,
					transparent: false,
					backgroundColor: 0x999999
				}
			});
		</script>
		<footer>CloudKid 2014, smoke particle image from http://stemkoski.github.io/Three.js/images/smokeparticle.png</footer>
    </body>
</html>